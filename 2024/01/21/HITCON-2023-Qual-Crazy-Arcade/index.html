<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>HITCON 2023 Qual Crazy Arcade • ShallowFeather Blog</title><meta name="description" content="HITCON 2023 Qual Crazy Arcade - ShallowFeather"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="ShallowFeather Blog"><meta name="generator" content="Hexo 7.1.0"><link rel="alternate" href="/atom.xml" title="ShallowFeather Blog" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="ShallowFeather Blog">ShallowFeather Blog</a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">HITCON 2023 Qual Crazy Arcade</h1><div class="post-info"><a></a>2024-01-21</div><div class="post-content"><p>這次超久才寫 WriteUp<br>學校有點多東西要忙</p>
<p>今年的 Hitcon 只有解這題 另一題 Rust 交換沒看很懂<br>這題是跟漢堡一起解的。<br>把他分析差不多以後我跟他說要全部變幽靈才 call 的到那個 Function 結果他說不用就會 call 到<br>浪費好多時間&#x3D;&#x3D;</p>
<h2 id="解題流程"><a href="#解題流程" class="headerlink" title="解題流程"></a>解題流程</h2><p>首先打開遊戲可以看到他會載入他同資料夾中的驅動<br><img src="https://cdn.discordapp.com/attachments/464447402557046784/1153694603271209103/image.png" alt="image"></p>
<p>然後看到下面接 IO 的這個名稱，有沒有很熟悉<br>這個是 Msi AfterBurner 之前出問題的驅動阿<br>漏洞主要是任意讀寫記憶體<br>並且對照後面的 DeviceIoControl 也能夠猜到它是使用了讀寫功能</p>
<p>然後後面我就先動態分析，想說只要通關說不定會有些東西<br>因為他說有幾層，我以為只要成功過就可以了<br>因此我是先開始分析它是怎麼生成拉桿的<br><img src="https://cdn.discordapp.com/attachments/464447402557046784/1153696329290227762/image.png" alt="image"></p>
<p>這個位置會生成拉桿 然後確定他是否在牆裡面<br>至於下面的 73 41 則是玩家的 XY 值<br>因此只要控制它的 rand 的輸出值跟玩家位置就可以通關了<br>不過 很顯然的 通關並不是它的目的</p>
<p>在 7990 的函數位置可以發現一個有趣的東西<br><img src="https://cdn.discordapp.com/attachments/464447402557046784/1153697154158821446/image.png" alt="image"></p>
<p>它是 Win 欸<br>代表說應該就是上面的 DAT_140016238 的變數操作會有可能涉及 Flag 了<br><img src="https://cdn.discordapp.com/attachments/464447402557046784/1153697584657993748/image.png" alt="image"></p>
<p>透過找對這個變數讀寫的位置後可以發現這個有趣的東西<br>這不就是對 RTcore64 進行操作的 IOCTL 嗎<br>那當初我發現這個函數時是先下斷點在要執行 IO 那邊<br>通關試試看 那很明顯一點用也沒有</p>
<p>反正總之，上面不是檢查是不是 5 嗎<br>漢堡就寫了一個 CE 腳本<br>直接開改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123; Game   : CrazyArcade.exe</span><br><span class="line">  Version: </span><br><span class="line">  Date   : 2023-09-09</span><br><span class="line">  Author : 123</span><br><span class="line"></span><br><span class="line">  This script does blah blah blah</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[ENABLE]</span><br><span class="line"></span><br><span class="line">aobscanmodule(INJECT,CrazyArcade.exe,83 3C 90 05 0F 85 A4 01 00 00) // should be unique</span><br><span class="line">alloc(newmem,$1000,INJECT)</span><br><span class="line"></span><br><span class="line">label(code)</span><br><span class="line">label(return)</span><br><span class="line"></span><br><span class="line">newmem:</span><br><span class="line"></span><br><span class="line">code:</span><br><span class="line">  push 5</span><br><span class="line">  pop dword ptr [rax+rdx*4]</span><br><span class="line">  cmp dword ptr [rax+rdx*4],05</span><br><span class="line">  jne CrazyArcade.exe+328E</span><br><span class="line">  jmp return</span><br><span class="line"></span><br><span class="line">INJECT:</span><br><span class="line">  jmp newmem</span><br><span class="line">  nop 5</span><br><span class="line">return:</span><br><span class="line">registersymbol(INJECT)</span><br><span class="line"></span><br><span class="line">[DISABLE]</span><br><span class="line"></span><br><span class="line">INJECT:</span><br><span class="line">  db 83 3C 90 05 0F 85 A4 01 00 00</span><br><span class="line"></span><br><span class="line">unregistersymbol(INJECT)</span><br><span class="line">dealloc(newmem)</span><br></pre></td></tr></table></figure>
<p>反正我也不知道怎麼生成的 難怪大家都說楓之谷是練功場</p>
<p>阿 在執行之前記得在那個 call IO 的裡面下斷點</p>
<p>然後在那邊找到一個很可疑的 Address 看起來像是某個 Driver 的區塊</p>
<p>FFFFF805426C3000 這個位置</p>
<p>然後接下來就是要處理它該怎麼讓它一直 call 檢查那塊了<br><img src="https://cdn.discordapp.com/attachments/464447402557046784/1153706531452375112/image.png" alt="image"></p>
<p>然後我鎖定了 71B6 那塊 還有後面的一個 JNZ 都改成 NOP<br>不就會一直呼叫了嗎</p>
<p>接下來就是漫長的等待 等到它跑 0x1337 次後 Flag 就會出現在 FFFFF805426C3000 這個位置上了<br><img src="https://cdn.discordapp.com/attachments/464447402557046784/1153707389699227749/image.png" alt="image"></p>
</div></article></div></main><footer><div class="paginator"><a class="next" href="/2024/01/21/AIS3-EOF-Qual-2024-writeup/">next</a></div><div class="copyright"><p>&copy; 2023 - 2024 <a target="_blank" rel="noopener" href="https://github.com/shallowfeather">ShallowFeather</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'G-R3NRYM6M1V']);
_gaq.push(['_trackPageview']);

(function () {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>